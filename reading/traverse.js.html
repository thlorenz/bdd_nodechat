<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/Dropboxes/Gmail/Dropbox/dev/javascript/node/sourcetopdf/node_modules/seq/node_modules/chainsaw/node_modules/traverse/index.js.html</title>
<meta name="Generator" content="Vim/7.3">
<meta name="plugin-version" content="vim7.3_v6">
<meta name="syntax" content="javascript">
<meta name="settings" content="use_css,number_lines">
<style type="text/css">
<!--
pre { font-family: monospace; color: #ffffff; background-color: #333333; }
body { font-family: monospace; color: #ffffff; background-color: #333333; }
.lnr { color: #ffff00; }
.Comment { color: #87ceeb; }
.Constant { color: #ffa0a0; }
.Type { color: #bdb76b; font-weight: bold; }
.Statement { color: #f0e68c; font-weight: bold; }
.Identifier { color: #98fb98; }
-->
</style>
</head>
<body>
<pre>
<span class="lnr">  1 </span>module.exports = Traverse;
<span class="lnr">  2 </span><span class="Identifier">function</span> Traverse (obj) <span class="Identifier">{</span>
<span class="lnr">  3 </span>    <span class="Statement">if</span> (!(<span class="Identifier">this</span> <span class="Statement">instanceof</span> Traverse)) <span class="Statement">return</span> <span class="Statement">new</span> Traverse(obj);
<span class="lnr">  4 </span>    <span class="Identifier">this</span>.value = obj;
<span class="lnr">  5 </span><span class="Identifier">}</span>
<span class="lnr">  6 </span>
<span class="lnr">  7 </span>Traverse.prototype.get = <span class="Identifier">function</span> (ps) <span class="Identifier">{</span>
<span class="lnr">  8 </span>    <span class="Identifier">var</span> node = <span class="Identifier">this</span>.value;
<span class="lnr">  9 </span>    <span class="Statement">for</span> (<span class="Identifier">var</span> i = 0; i &lt; ps.length; i ++) <span class="Identifier">{</span>
<span class="lnr"> 10 </span>        <span class="Identifier">var</span> key = ps<span class="Identifier">[</span>i<span class="Identifier">]</span>;
<span class="lnr"> 11 </span>        <span class="Statement">if</span> (!<span class="Type">Object</span>.hasOwnProperty.call(node, key)) <span class="Identifier">{</span>
<span class="lnr"> 12 </span>            node = <span class="Statement">undefined</span>;
<span class="lnr"> 13 </span>            <span class="Statement">break</span>;
<span class="lnr"> 14 </span>        <span class="Identifier">}</span>
<span class="lnr"> 15 </span>        node = node<span class="Identifier">[</span>key<span class="Identifier">]</span>;
<span class="lnr"> 16 </span>    <span class="Identifier">}</span>
<span class="lnr"> 17 </span>    <span class="Statement">return</span> node;
<span class="lnr"> 18 </span><span class="Identifier">}</span>;
<span class="lnr"> 19 </span>
<span class="lnr"> 20 </span>Traverse.prototype.set = <span class="Identifier">function</span> (ps, value) <span class="Identifier">{</span>
<span class="lnr"> 21 </span>    <span class="Identifier">var</span> node = <span class="Identifier">this</span>.value;
<span class="lnr"> 22 </span>    <span class="Statement">for</span> (<span class="Identifier">var</span> i = 0; i &lt; ps.length - 1; i ++) <span class="Identifier">{</span>
<span class="lnr"> 23 </span>        <span class="Identifier">var</span> key = ps<span class="Identifier">[</span>i<span class="Identifier">]</span>;
<span class="lnr"> 24 </span>        <span class="Statement">if</span> (!<span class="Type">Object</span>.hasOwnProperty.call(node, key)) node<span class="Identifier">[</span>key<span class="Identifier">]</span> = <span class="Identifier">{}</span>;
<span class="lnr"> 25 </span>        node = node<span class="Identifier">[</span>key<span class="Identifier">]</span>;
<span class="lnr"> 26 </span>    <span class="Identifier">}</span>
<span class="lnr"> 27 </span>    node<span class="Identifier">[</span>ps<span class="Identifier">[</span>i<span class="Identifier">]]</span> = value;
<span class="lnr"> 28 </span>    <span class="Statement">return</span> value;
<span class="lnr"> 29 </span><span class="Identifier">}</span>;
<span class="lnr"> 30 </span>
<span class="lnr"> 31 </span>Traverse.prototype.map = <span class="Identifier">function</span> (cb) <span class="Identifier">{</span>
<span class="lnr"> 32 </span>    <span class="Statement">return</span> walk(<span class="Identifier">this</span>.value, cb, <span class="Constant">true</span>);
<span class="lnr"> 33 </span><span class="Identifier">}</span>;
<span class="lnr"> 34 </span>
<span class="lnr"> 35 </span>Traverse.prototype.forEach = <span class="Identifier">function</span> (cb) <span class="Identifier">{</span>
<span class="lnr"> 36 </span>    <span class="Identifier">this</span>.value = walk(<span class="Identifier">this</span>.value, cb, <span class="Constant">false</span>);
<span class="lnr"> 37 </span>    <span class="Statement">return</span> <span class="Identifier">this</span>.value;
<span class="lnr"> 38 </span><span class="Identifier">}</span>;
<span class="lnr"> 39 </span>
<span class="lnr"> 40 </span>Traverse.prototype.reduce = <span class="Identifier">function</span> (cb, init) <span class="Identifier">{</span>
<span class="lnr"> 41 </span>    <span class="Identifier">var</span> skip = <span class="Identifier">arguments</span>.length === 1;
<span class="lnr"> 42 </span>    <span class="Identifier">var</span> acc = skip ? <span class="Identifier">this</span>.value : init;
<span class="lnr"> 43 </span>    <span class="Identifier">this</span>.forEach(<span class="Identifier">function</span> (x) <span class="Identifier">{</span>
<span class="lnr"> 44 </span>        <span class="Statement">if</span> (!<span class="Identifier">this</span>.isRoot || !skip) <span class="Identifier">{</span>
<span class="lnr"> 45 </span>            acc = cb.call(<span class="Identifier">this</span>, acc, x);
<span class="lnr"> 46 </span>        <span class="Identifier">}</span>
<span class="lnr"> 47 </span>    <span class="Identifier">}</span>);
<span class="lnr"> 48 </span>    <span class="Statement">return</span> acc;
<span class="lnr"> 49 </span><span class="Identifier">}</span>;
<span class="lnr"> 50 </span>
<span class="lnr"> 51 </span>Traverse.prototype.deepEqual = <span class="Identifier">function</span> (obj) <span class="Identifier">{</span>
<span class="lnr"> 52 </span>    <span class="Statement">if</span> (<span class="Identifier">arguments</span>.length !== 1) <span class="Identifier">{</span>
<span class="lnr"> 53 </span>        <span class="Statement">throw</span> <span class="Statement">new</span> Error(
<span class="lnr"> 54 </span>            <span class="Constant">'deepEqual requires exactly one object to compare against'</span>
<span class="lnr"> 55 </span>        );
<span class="lnr"> 56 </span>    <span class="Identifier">}</span>
<span class="lnr"> 57 </span>
<span class="lnr"> 58 </span>    <span class="Identifier">var</span> equal = <span class="Constant">true</span>;
<span class="lnr"> 59 </span>    <span class="Identifier">var</span> node = obj;
<span class="lnr"> 60 </span>
<span class="lnr"> 61 </span>    <span class="Identifier">this</span>.forEach(<span class="Identifier">function</span> (y) <span class="Identifier">{</span>
<span class="lnr"> 62 </span>        <span class="Identifier">var</span> notEqual = (<span class="Identifier">function</span> () <span class="Identifier">{</span>
<span class="lnr"> 63 </span>            equal = <span class="Constant">false</span>;
<span class="lnr"> 64 </span>            <span class="Comment">//this.stop();</span>
<span class="lnr"> 65 </span>            <span class="Statement">return</span> <span class="Statement">undefined</span>;
<span class="lnr"> 66 </span>        <span class="Identifier">}</span>).bind(<span class="Identifier">this</span>);
<span class="lnr"> 67 </span>
<span class="lnr"> 68 </span>        <span class="Comment">//if (node === undefined || node === null) return notEqual();</span>
<span class="lnr"> 69 </span>
<span class="lnr"> 70 </span>        <span class="Statement">if</span> (!<span class="Identifier">this</span>.isRoot) <span class="Identifier">{</span>
<span class="lnr"> 71 </span>        <span class="Comment">/*</span>
<span class="lnr"> 72 </span><span class="Comment">            if (!Object.hasOwnProperty.call(node, this.key)) {</span>
<span class="lnr"> 73 </span><span class="Comment">                return notEqual();</span>
<span class="lnr"> 74 </span><span class="Comment">            }</span>
<span class="lnr"> 75 </span><span class="Comment">        */</span>
<span class="lnr"> 76 </span>            <span class="Statement">if</span> (<span class="Statement">typeof</span> node !== <span class="Constant">'object'</span>) <span class="Statement">return</span> notEqual();
<span class="lnr"> 77 </span>            node = node<span class="Identifier">[</span><span class="Identifier">this</span>.key<span class="Identifier">]</span>;
<span class="lnr"> 78 </span>        <span class="Identifier">}</span>
<span class="lnr"> 79 </span>
<span class="lnr"> 80 </span>        <span class="Identifier">var</span> x = node;
<span class="lnr"> 81 </span>
<span class="lnr"> 82 </span>        <span class="Identifier">this</span>.post(<span class="Identifier">function</span> () <span class="Identifier">{</span>
<span class="lnr"> 83 </span>            node = x;
<span class="lnr"> 84 </span>        <span class="Identifier">}</span>);
<span class="lnr"> 85 </span>
<span class="lnr"> 86 </span>        <span class="Identifier">var</span> toS = <span class="Identifier">function</span> (o) <span class="Identifier">{</span>
<span class="lnr"> 87 </span>            <span class="Statement">return</span> <span class="Type">Object</span>.prototype.toString.call(o);
<span class="lnr"> 88 </span>        <span class="Identifier">}</span>;
<span class="lnr"> 89 </span>
<span class="lnr"> 90 </span>        <span class="Statement">if</span> (<span class="Identifier">this</span>.circular) <span class="Identifier">{</span>
<span class="lnr"> 91 </span>            <span class="Statement">if</span> (Traverse(obj).get(<span class="Identifier">this</span>.circular.path) !== x) notEqual();
<span class="lnr"> 92 </span>        <span class="Identifier">}</span>
<span class="lnr"> 93 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (<span class="Statement">typeof</span> x !== <span class="Statement">typeof</span> y) <span class="Identifier">{</span>
<span class="lnr"> 94 </span>            notEqual();
<span class="lnr"> 95 </span>        <span class="Identifier">}</span>
<span class="lnr"> 96 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (x === <span class="Statement">null</span> || y === <span class="Statement">null</span> || x === <span class="Statement">undefined</span> || y === <span class="Statement">undefined</span>) <span class="Identifier">{</span>
<span class="lnr"> 97 </span>            <span class="Statement">if</span> (x !== y) notEqual();
<span class="lnr"> 98 </span>        <span class="Identifier">}</span>
<span class="lnr"> 99 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (x.__proto__ !== y.__proto__) <span class="Identifier">{</span>
<span class="lnr">100 </span>            notEqual();
<span class="lnr">101 </span>        <span class="Identifier">}</span>
<span class="lnr">102 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (x === y) <span class="Identifier">{</span>
<span class="lnr">103 </span>            <span class="Comment">// nop</span>
<span class="lnr">104 </span>        <span class="Identifier">}</span>
<span class="lnr">105 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (<span class="Statement">typeof</span> x === <span class="Constant">'function'</span>) <span class="Identifier">{</span>
<span class="lnr">106 </span>            <span class="Statement">if</span> (x <span class="Statement">instanceof</span> <span class="Type">RegExp</span>) <span class="Identifier">{</span>
<span class="lnr">107 </span>                <span class="Comment">// both regexps on account of the __proto__ check</span>
<span class="lnr">108 </span>                <span class="Statement">if</span> (x.toString() != y.toString()) notEqual();
<span class="lnr">109 </span>            <span class="Identifier">}</span>
<span class="lnr">110 </span>            <span class="Statement">else</span> <span class="Statement">if</span> (x !== y) notEqual();
<span class="lnr">111 </span>        <span class="Identifier">}</span>
<span class="lnr">112 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (<span class="Statement">typeof</span> x === <span class="Constant">'object'</span>) <span class="Identifier">{</span>
<span class="lnr">113 </span>            <span class="Statement">if</span> (toS(y) === <span class="Constant">'[object Arguments]'</span>
<span class="lnr">114 </span>            || toS(x) === <span class="Constant">'[object Arguments]'</span>) <span class="Identifier">{</span>
<span class="lnr">115 </span>                <span class="Statement">if</span> (toS(x) !== toS(y)) <span class="Identifier">{</span>
<span class="lnr">116 </span>                    notEqual();
<span class="lnr">117 </span>                <span class="Identifier">}</span>
<span class="lnr">118 </span>            <span class="Identifier">}</span>
<span class="lnr">119 </span>            <span class="Statement">else</span> <span class="Statement">if</span> (x <span class="Statement">instanceof</span> <span class="Type">Date</span> || y <span class="Statement">instanceof</span> <span class="Type">Date</span>) <span class="Identifier">{</span>
<span class="lnr">120 </span>                <span class="Statement">if</span> (!(x <span class="Statement">instanceof</span> <span class="Type">Date</span>) || !(y <span class="Statement">instanceof</span> <span class="Type">Date</span>)
<span class="lnr">121 </span>                || x.getTime() !== y.getTime()) <span class="Identifier">{</span>
<span class="lnr">122 </span>                    notEqual();
<span class="lnr">123 </span>                <span class="Identifier">}</span>
<span class="lnr">124 </span>            <span class="Identifier">}</span>
<span class="lnr">125 </span>            <span class="Statement">else</span> <span class="Identifier">{</span>
<span class="lnr">126 </span>                <span class="Identifier">var</span> kx = <span class="Type">Object</span>.keys(x);
<span class="lnr">127 </span>                <span class="Identifier">var</span> ky = <span class="Type">Object</span>.keys(y);
<span class="lnr">128 </span>                <span class="Statement">if</span> (kx.length !== ky.length) <span class="Statement">return</span> notEqual();
<span class="lnr">129 </span>                <span class="Statement">for</span> (<span class="Identifier">var</span> i = 0; i &lt; kx.length; i++) <span class="Identifier">{</span>
<span class="lnr">130 </span>                    <span class="Identifier">var</span> k = kx<span class="Identifier">[</span>i<span class="Identifier">]</span>;
<span class="lnr">131 </span>                    <span class="Statement">if</span> (!<span class="Type">Object</span>.hasOwnProperty.call(y, k)) <span class="Identifier">{</span>
<span class="lnr">132 </span>                        notEqual();
<span class="lnr">133 </span>                    <span class="Identifier">}</span>
<span class="lnr">134 </span>                <span class="Identifier">}</span>
<span class="lnr">135 </span>            <span class="Identifier">}</span>
<span class="lnr">136 </span>        <span class="Identifier">}</span>
<span class="lnr">137 </span>    <span class="Identifier">}</span>);
<span class="lnr">138 </span>
<span class="lnr">139 </span>    <span class="Statement">return</span> equal;
<span class="lnr">140 </span><span class="Identifier">}</span>;
<span class="lnr">141 </span>
<span class="lnr">142 </span>Traverse.prototype.paths = <span class="Identifier">function</span> () <span class="Identifier">{</span>
<span class="lnr">143 </span>    <span class="Identifier">var</span> acc = <span class="Identifier">[]</span>;
<span class="lnr">144 </span>    <span class="Identifier">this</span>.forEach(<span class="Identifier">function</span> (x) <span class="Identifier">{</span>
<span class="lnr">145 </span>        acc.push(<span class="Identifier">this</span>.path);
<span class="lnr">146 </span>    <span class="Identifier">}</span>);
<span class="lnr">147 </span>    <span class="Statement">return</span> acc;
<span class="lnr">148 </span><span class="Identifier">}</span>;
<span class="lnr">149 </span>
<span class="lnr">150 </span>Traverse.prototype.nodes = <span class="Identifier">function</span> () <span class="Identifier">{</span>
<span class="lnr">151 </span>    <span class="Identifier">var</span> acc = <span class="Identifier">[]</span>;
<span class="lnr">152 </span>    <span class="Identifier">this</span>.forEach(<span class="Identifier">function</span> (x) <span class="Identifier">{</span>
<span class="lnr">153 </span>        acc.push(<span class="Identifier">this</span>.node);
<span class="lnr">154 </span>    <span class="Identifier">}</span>);
<span class="lnr">155 </span>    <span class="Statement">return</span> acc;
<span class="lnr">156 </span><span class="Identifier">}</span>;
<span class="lnr">157 </span>
<span class="lnr">158 </span>Traverse.prototype.clone = <span class="Identifier">function</span> () <span class="Identifier">{</span>
<span class="lnr">159 </span>    <span class="Identifier">var</span> parents = <span class="Identifier">[]</span>, nodes = <span class="Identifier">[]</span>;
<span class="lnr">160 </span>
<span class="lnr">161 </span>    <span class="Statement">return</span> (<span class="Identifier">function</span> clone (src) <span class="Identifier">{</span>
<span class="lnr">162 </span>        <span class="Statement">for</span> (<span class="Identifier">var</span> i = 0; i &lt; parents.length; i++) <span class="Identifier">{</span>
<span class="lnr">163 </span>            <span class="Statement">if</span> (parents<span class="Identifier">[</span>i<span class="Identifier">]</span> === src) <span class="Identifier">{</span>
<span class="lnr">164 </span>                <span class="Statement">return</span> nodes<span class="Identifier">[</span>i<span class="Identifier">]</span>;
<span class="lnr">165 </span>            <span class="Identifier">}</span>
<span class="lnr">166 </span>        <span class="Identifier">}</span>
<span class="lnr">167 </span>
<span class="lnr">168 </span>        <span class="Statement">if</span> (<span class="Statement">typeof</span> src === <span class="Constant">'object'</span> &amp;&amp; src !== <span class="Statement">null</span>) <span class="Identifier">{</span>
<span class="lnr">169 </span>            <span class="Identifier">var</span> dst = copy(src);
<span class="lnr">170 </span>
<span class="lnr">171 </span>            parents.push(src);
<span class="lnr">172 </span>            nodes.push(dst);
<span class="lnr">173 </span>
<span class="lnr">174 </span>            <span class="Type">Object</span>.keys(src).forEach(<span class="Identifier">function</span> (key) <span class="Identifier">{</span>
<span class="lnr">175 </span>                dst<span class="Identifier">[</span>key<span class="Identifier">]</span> = clone(src<span class="Identifier">[</span>key<span class="Identifier">]</span>);
<span class="lnr">176 </span>            <span class="Identifier">}</span>);
<span class="lnr">177 </span>
<span class="lnr">178 </span>            parents.pop();
<span class="lnr">179 </span>            nodes.pop();
<span class="lnr">180 </span>            <span class="Statement">return</span> dst;
<span class="lnr">181 </span>        <span class="Identifier">}</span>
<span class="lnr">182 </span>        <span class="Statement">else</span> <span class="Identifier">{</span>
<span class="lnr">183 </span>            <span class="Statement">return</span> src;
<span class="lnr">184 </span>        <span class="Identifier">}</span>
<span class="lnr">185 </span>    <span class="Identifier">}</span>)(<span class="Identifier">this</span>.value);
<span class="lnr">186 </span><span class="Identifier">}</span>;
<span class="lnr">187 </span>
<span class="lnr">188 </span><span class="Identifier">function</span> walk (root, cb, immutable) <span class="Identifier">{</span>
<span class="lnr">189 </span>    <span class="Identifier">var</span> path = <span class="Identifier">[]</span>;
<span class="lnr">190 </span>    <span class="Identifier">var</span> parents = <span class="Identifier">[]</span>;
<span class="lnr">191 </span>    <span class="Identifier">var</span> alive = <span class="Constant">true</span>;
<span class="lnr">192 </span>
<span class="lnr">193 </span>    <span class="Statement">return</span> (<span class="Identifier">function</span> walker (node_) <span class="Identifier">{</span>
<span class="lnr">194 </span>        <span class="Identifier">var</span> node = immutable ? copy(node_) : node_;
<span class="lnr">195 </span>        <span class="Identifier">var</span> modifiers = <span class="Identifier">{}</span>;
<span class="lnr">196 </span>
<span class="lnr">197 </span>        <span class="Identifier">var</span> state = <span class="Identifier">{</span>
<span class="lnr">198 </span>            node : node,
<span class="lnr">199 </span>            node_ : node_,
<span class="lnr">200 </span>            path : <span class="Identifier">[]</span>.concat(path),
<span class="lnr">201 </span>            <span class="Statement">parent</span> : parents.slice(-1)<span class="Identifier">[</span>0<span class="Identifier">]</span>,
<span class="lnr">202 </span>            key : path.slice(-1)<span class="Identifier">[</span>0<span class="Identifier">]</span>,
<span class="lnr">203 </span>            isRoot : path.length === 0,
<span class="lnr">204 </span>            level : path.length,
<span class="lnr">205 </span>            circular : <span class="Statement">null</span>,
<span class="lnr">206 </span>            update : <span class="Identifier">function</span> (x) <span class="Identifier">{</span>
<span class="lnr">207 </span>                <span class="Statement">if</span> (!state.isRoot) <span class="Identifier">{</span>
<span class="lnr">208 </span>                    state.<span class="Statement">parent</span>.node<span class="Identifier">[</span>state.key<span class="Identifier">]</span> = x;
<span class="lnr">209 </span>                <span class="Identifier">}</span>
<span class="lnr">210 </span>                state.node = x;
<span class="lnr">211 </span>            <span class="Identifier">}</span>,
<span class="lnr">212 </span>            <span class="Constant">'delete'</span> : <span class="Identifier">function</span> () <span class="Identifier">{</span>
<span class="lnr">213 </span>                <span class="Statement">delete</span> state.<span class="Statement">parent</span>.node<span class="Identifier">[</span>state.key<span class="Identifier">]</span>;
<span class="lnr">214 </span>            <span class="Identifier">}</span>,
<span class="lnr">215 </span>            remove : <span class="Identifier">function</span> () <span class="Identifier">{</span>
<span class="lnr">216 </span>                <span class="Statement">if</span> (<span class="Type">Array</span>.isArray(state.<span class="Statement">parent</span>.node)) <span class="Identifier">{</span>
<span class="lnr">217 </span>                    state.<span class="Statement">parent</span>.node.splice(state.key, 1);
<span class="lnr">218 </span>                <span class="Identifier">}</span>
<span class="lnr">219 </span>                <span class="Statement">else</span> <span class="Identifier">{</span>
<span class="lnr">220 </span>                    <span class="Statement">delete</span> state.<span class="Statement">parent</span>.node<span class="Identifier">[</span>state.key<span class="Identifier">]</span>;
<span class="lnr">221 </span>                <span class="Identifier">}</span>
<span class="lnr">222 </span>            <span class="Identifier">}</span>,
<span class="lnr">223 </span>            before : <span class="Identifier">function</span> (f) <span class="Identifier">{</span> modifiers.before = f <span class="Identifier">}</span>,
<span class="lnr">224 </span>            after : <span class="Identifier">function</span> (f) <span class="Identifier">{</span> modifiers.after = f <span class="Identifier">}</span>,
<span class="lnr">225 </span>            pre : <span class="Identifier">function</span> (f) <span class="Identifier">{</span> modifiers.pre = f <span class="Identifier">}</span>,
<span class="lnr">226 </span>            post : <span class="Identifier">function</span> (f) <span class="Identifier">{</span> modifiers.post = f <span class="Identifier">}</span>,
<span class="lnr">227 </span>            stop : <span class="Identifier">function</span> () <span class="Identifier">{</span> alive = <span class="Constant">false</span> <span class="Identifier">}</span>
<span class="lnr">228 </span>        <span class="Identifier">}</span>;
<span class="lnr">229 </span>
<span class="lnr">230 </span>        <span class="Statement">if</span> (!alive) <span class="Statement">return</span> state;
<span class="lnr">231 </span>
<span class="lnr">232 </span>        <span class="Statement">if</span> (<span class="Statement">typeof</span> node === <span class="Constant">'object'</span> &amp;&amp; node !== <span class="Statement">null</span>) <span class="Identifier">{</span>
<span class="lnr">233 </span>            state.isLeaf = <span class="Type">Object</span>.keys(node).length == 0;
<span class="lnr">234 </span>
<span class="lnr">235 </span>            <span class="Statement">for</span> (<span class="Identifier">var</span> i = 0; i &lt; parents.length; i++) <span class="Identifier">{</span>
<span class="lnr">236 </span>                <span class="Statement">if</span> (parents<span class="Identifier">[</span>i<span class="Identifier">]</span>.node_ === node_) <span class="Identifier">{</span>
<span class="lnr">237 </span>                    state.circular = parents<span class="Identifier">[</span>i<span class="Identifier">]</span>;
<span class="lnr">238 </span>                    <span class="Statement">break</span>;
<span class="lnr">239 </span>                <span class="Identifier">}</span>
<span class="lnr">240 </span>            <span class="Identifier">}</span>
<span class="lnr">241 </span>        <span class="Identifier">}</span>
<span class="lnr">242 </span>        <span class="Statement">else</span> <span class="Identifier">{</span>
<span class="lnr">243 </span>            state.isLeaf = <span class="Constant">true</span>;
<span class="lnr">244 </span>        <span class="Identifier">}</span>
<span class="lnr">245 </span>
<span class="lnr">246 </span>        state.notLeaf = !state.isLeaf;
<span class="lnr">247 </span>        state.notRoot = !state.isRoot;
<span class="lnr">248 </span>
<span class="lnr">249 </span>        <span class="Comment">// use return values to update if defined</span>
<span class="lnr">250 </span>        <span class="Identifier">var</span> ret = cb.call(state, state.node);
<span class="lnr">251 </span>        <span class="Statement">if</span> (ret !== <span class="Statement">undefined</span> &amp;&amp; state.update) state.update(ret);
<span class="lnr">252 </span>        <span class="Statement">if</span> (modifiers.before) modifiers.before.call(state, state.node);
<span class="lnr">253 </span>
<span class="lnr">254 </span>        <span class="Statement">if</span> (<span class="Statement">typeof</span> state.node == <span class="Constant">'object'</span>
<span class="lnr">255 </span>        &amp;&amp; state.node !== <span class="Statement">null</span> &amp;&amp; !state.circular) <span class="Identifier">{</span>
<span class="lnr">256 </span>            parents.push(state);
<span class="lnr">257 </span>
<span class="lnr">258 </span>            <span class="Identifier">var</span> keys = <span class="Type">Object</span>.keys(state.node);
<span class="lnr">259 </span>            keys.forEach(<span class="Identifier">function</span> (key, i) <span class="Identifier">{</span>
<span class="lnr">260 </span>                path.push(key);
<span class="lnr">261 </span>
<span class="lnr">262 </span>                <span class="Statement">if</span> (modifiers.pre) modifiers.pre.call(state, state.node<span class="Identifier">[</span>key<span class="Identifier">]</span>, key);
<span class="lnr">263 </span>
<span class="lnr">264 </span>                <span class="Identifier">var</span> child = walker(state.node<span class="Identifier">[</span>key<span class="Identifier">]</span>);
<span class="lnr">265 </span>                <span class="Statement">if</span> (immutable &amp;&amp; <span class="Type">Object</span>.hasOwnProperty.call(state.node, key)) <span class="Identifier">{</span>
<span class="lnr">266 </span>                    state.node<span class="Identifier">[</span>key<span class="Identifier">]</span> = child.node;
<span class="lnr">267 </span>                <span class="Identifier">}</span>
<span class="lnr">268 </span>
<span class="lnr">269 </span>                child.isLast = i == keys.length - 1;
<span class="lnr">270 </span>                child.isFirst = i == 0;
<span class="lnr">271 </span>
<span class="lnr">272 </span>                <span class="Statement">if</span> (modifiers.post) modifiers.post.call(state, child);
<span class="lnr">273 </span>
<span class="lnr">274 </span>                path.pop();
<span class="lnr">275 </span>            <span class="Identifier">}</span>);
<span class="lnr">276 </span>            parents.pop();
<span class="lnr">277 </span>        <span class="Identifier">}</span>
<span class="lnr">278 </span>
<span class="lnr">279 </span>        <span class="Statement">if</span> (modifiers.after) modifiers.after.call(state, state.node);
<span class="lnr">280 </span>
<span class="lnr">281 </span>        <span class="Statement">return</span> state;
<span class="lnr">282 </span>    <span class="Identifier">}</span>)(root).node;
<span class="lnr">283 </span><span class="Identifier">}</span>
<span class="lnr">284 </span>
<span class="lnr">285 </span><span class="Type">Object</span>.keys(Traverse.prototype).forEach(<span class="Identifier">function</span> (key) <span class="Identifier">{</span>
<span class="lnr">286 </span>    Traverse<span class="Identifier">[</span>key<span class="Identifier">]</span> = <span class="Identifier">function</span> (obj) <span class="Identifier">{</span>
<span class="lnr">287 </span>        <span class="Identifier">var</span> args = <span class="Identifier">[]</span>.slice.call(<span class="Identifier">arguments</span>, 1);
<span class="lnr">288 </span>        <span class="Identifier">var</span> t = Traverse(obj);
<span class="lnr">289 </span>        <span class="Statement">return</span> t<span class="Identifier">[</span>key<span class="Identifier">]</span>.apply(t, args);
<span class="lnr">290 </span>    <span class="Identifier">}</span>;
<span class="lnr">291 </span><span class="Identifier">}</span>);
<span class="lnr">292 </span>
<span class="lnr">293 </span><span class="Identifier">function</span> copy (src) <span class="Identifier">{</span>
<span class="lnr">294 </span>    <span class="Statement">if</span> (<span class="Statement">typeof</span> src === <span class="Constant">'object'</span> &amp;&amp; src !== <span class="Statement">null</span>) <span class="Identifier">{</span>
<span class="lnr">295 </span>        <span class="Identifier">var</span> dst;
<span class="lnr">296 </span>
<span class="lnr">297 </span>        <span class="Statement">if</span> (<span class="Type">Array</span>.isArray(src)) <span class="Identifier">{</span>
<span class="lnr">298 </span>            dst = <span class="Identifier">[]</span>;
<span class="lnr">299 </span>        <span class="Identifier">}</span>
<span class="lnr">300 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (src <span class="Statement">instanceof</span> <span class="Type">Date</span>) <span class="Identifier">{</span>
<span class="lnr">301 </span>            dst = <span class="Statement">new</span> <span class="Type">Date</span>(src);
<span class="lnr">302 </span>        <span class="Identifier">}</span>
<span class="lnr">303 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (src <span class="Statement">instanceof</span> <span class="Type">Boolean</span>) <span class="Identifier">{</span>
<span class="lnr">304 </span>            dst = <span class="Statement">new</span> <span class="Type">Boolean</span>(src);
<span class="lnr">305 </span>        <span class="Identifier">}</span>
<span class="lnr">306 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (src <span class="Statement">instanceof</span> <span class="Type">Number</span>) <span class="Identifier">{</span>
<span class="lnr">307 </span>            dst = <span class="Statement">new</span> <span class="Type">Number</span>(src);
<span class="lnr">308 </span>        <span class="Identifier">}</span>
<span class="lnr">309 </span>        <span class="Statement">else</span> <span class="Statement">if</span> (src <span class="Statement">instanceof</span> <span class="Type">String</span>) <span class="Identifier">{</span>
<span class="lnr">310 </span>            dst = <span class="Statement">new</span> <span class="Type">String</span>(src);
<span class="lnr">311 </span>        <span class="Identifier">}</span>
<span class="lnr">312 </span>        <span class="Statement">else</span> <span class="Identifier">{</span>
<span class="lnr">313 </span>            dst = <span class="Type">Object</span>.create(<span class="Type">Object</span>.getPrototypeOf(src));
<span class="lnr">314 </span>        <span class="Identifier">}</span>
<span class="lnr">315 </span>
<span class="lnr">316 </span>        <span class="Type">Object</span>.keys(src).forEach(<span class="Identifier">function</span> (key) <span class="Identifier">{</span>
<span class="lnr">317 </span>            dst<span class="Identifier">[</span>key<span class="Identifier">]</span> = src<span class="Identifier">[</span>key<span class="Identifier">]</span>;
<span class="lnr">318 </span>        <span class="Identifier">}</span>);
<span class="lnr">319 </span>        <span class="Statement">return</span> dst;
<span class="lnr">320 </span>    <span class="Identifier">}</span>
<span class="lnr">321 </span>    <span class="Statement">else</span> <span class="Statement">return</span> src;
<span class="lnr">322 </span><span class="Identifier">}</span>
</pre>
</body>
</html>
